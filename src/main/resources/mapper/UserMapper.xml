<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.meeting.summary.mapper.UsersMapper">

    <!-- 컬럼명(스네이크) -> DTO 필드명(카멜) 매핑 -->
    <resultMap id="UserResultMap" type="com.meeting.summary.domain.Users">
        <id property="userId"      			column="user_id"/>			<!-- 회원 고유번호(SEQ) column : DB 컬럼명 -->
        <result property="loginId"      	column="login_id"/>			<!-- 회원 아이디 -->
        <result property="userPassword"		column="user_password"/>	<!-- 회원 비밀번호 -->
        <result property="name" 			column="name"/>				<!-- 이름 -->
        <result property="email"  			column="email"/>			<!-- 이메일 -->
        <result property="role"      		column="role"/>				<!-- 역할(회원, 관리자) -->
        <result property="lastLoginDate"  	column="last_login_date"/>	<!-- 마지막 접속일 -->
        <result property="deleted"   		column="deleted"/>			<!-- 삭제 여부. 기본값 false, 삭제 시 true  -->
        <result property="createdBy"   		column="created_by"/>		<!-- 생성자 -->
        <result property="modifiedBy" 		column="modified_by"/>  	<!-- 생성 시각 -->   	  
        <result property="createdDate" 		column="created_date"/>		<!-- 수정자 -->
        <result property="modifiedDate" 	column="modified_date"/>	<!-- 수정 시각 -->
    </resultMap>

    <!-- 회원 등록 useGeneratedKeys="true" : INSERT 실행 후 DB가 만든 PK를 받아옴 | keyProperty="id" : 받아온 생성 키 값을 파라미터 객체의 어느 프로퍼티에 넣을지 지정-->
    <insert id="insert" parameterType="com.meeting.summary.domain.Users" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO users    
        (login_id
        ,user_password
        ,name
        ,email
        ,role
        ,deleted
        ,created_by
        ,created_date
        ,modified_by
        ,modified_date)
        VALUES
        (#{loginId}
        ,#{userPassword}
        ,#{name}
        ,#{email}
        ,'User'
        ,false
        ,#{createdBy}
        ,NOW()
        ,#{modifiedBy}
        ,NOW())
    </insert>
    
    <!-- 회원 수정 Parameter : userId, Users -->    
    <update id="update">
        UPDATE users
        SET user_password 	= #{user.userPassword}
           ,name			= #{user.name}
           ,email			= #{user.email}
           ,modified_by 	= #{userId}
           ,modified_date 	= NOW()
        WHERE 1 = 1
       	  AND user_id		= #{userId}
          AND deleted 		= false
    </update>
    
    <!-- 회원 삭제 Parameter : userId -->
    <update id="delete">
        UPDATE users
        SET deleted 		= true
           ,modified_by 	= #{userId}
           ,modified_date 	= NOW()
        WHERE 1 = 1
          AND user_id		= #{userId}
          AND deleted	 	= false
    </update>
	
    <!-- 회원 조회 -->
    <select id="findByUserId" resultMap="UserResultMap">
        SELECT user_id
        	  ,login_id
        	  ,name
        	  ,email
        FROM  users
        WHERE 1 = 1
          AND user_id	= #{userId}
          AND deleted	= false
    </select>
    
</mapper>
