<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.meeting.summary.mapper.MeetingMapper">

    <!-- 컬럼명(스네이크) -> DTO 필드명(카멜) 매핑 -->
    <resultMap id="MeetingResultMap" type="com.meeting.summary.domain.Meeting">
        <id     property="meetingId"	column="meeting_id"/>	<!-- 회의록 고유번호(SEQ) column : DB 컬럼명-->
        <result property="userId"      	column="user_id"/>		<!-- 사용자 고유번호(FK)  -->
        <result property="title"       	column="title"/>		<!-- 회의록 제목  -->
        <result property="body"        	column="body"/>			<!-- 회의록 내용  -->
        <result property="description" 	column="description"/>	<!-- 회의록 메모  -->
        <result property="visibility"  	column="visibility"/>	<!-- 회의록 공개상태(공개/비공개)  -->
        <result property="status"      	column="status"/>		<!-- 회의록 상태(요약완료/요약미완료)  -->
        <result property="meetingDate"  column="meeting_date"/>	<!-- 회의일  -->
        <result property="startTime"   	column="start_time"/>	<!-- 회의 시작 시간  -->
        <result property="endTime"     	column="end_time"/>		<!-- 회의 종료 시간  -->
        <result property="deleted"   	column="deleted"/>		<!-- 삭제 여부. 기본값 false, 삭제 시 true  -->
        <result property="createdBy"   	column="created_by"/>	<!-- 생성자  -->
        <result property="modifiedBy" 	column="modified_by"/>  <!-- 생성 시각  -->   	  
        <result property="createdDate" 	column="created_date"/>	<!-- 수정자  -->
        <result property="modifiedDate" column="modified_date"/><!-- 수정 시각  -->
    </resultMap>

    <!-- 회의록 등록 useGeneratedKeys="true" : INSERT 실행 후 DB가 만든 PK를 받아옴 | keyProperty="id" : 받아온 생성 키 값을 파라미터 객체의 어느 프로퍼티에 넣을지 지정-->
    <insert id="insert" parameterType="com.meeting.summary.domain.Meeting" useGeneratedKeys="true" keyProperty="meetingId">
        INSERT INTO meeting    
        (user_id
        ,title
        ,body
        ,description
        ,visibility
        ,status
        ,meeting_date
        ,start_time
        ,end_time
        ,deleted
        ,created_by
        ,created_date
        ,modified_by
        ,modified_date)
        VALUES
        (#{userId}
        ,#{title}
        ,#{body}
        ,#{description}
        ,#{visibility}
        ,#{status}
        ,#{meetingDate}
        ,#{startTime}
        ,#{endTime}
        ,false
        ,#{createdBy}
        ,NOW()
        ,#{modifiedBy}
        ,NOW())
    </insert>
    
    <!-- 회의록 수정 Parameter : userId, meetingId, meeting-->    
    <update id="update">
        UPDATE meeting
        SET title 			= #{meeting.title}
           ,body			= #{meeting.body}
           ,description		= #{meeting.description}
           ,visibility		= #{meeting.visibility}
           ,status			= #{meeting.status}
           ,meeting_date	= #{meeting.meetingDate}
           ,start_time		= #{meeting.startTime}
           ,end_time		= #{meeting.endTime}
           ,modified_by 	= #{userId}
           ,modified_date 	= NOW()
        WHERE 1 = 1
          AND meeting_id 	= #{meetingId}
       	  AND user_id		= #{userId}
          AND deleted 		= false
    </update>
    
    <!-- 회의록 삭제 Parameter : userId, meetingId -->
    <update id="delete">
        UPDATE meeting
        SET deleted 		= true
           ,modified_by 	= #{userId}
           ,modified_date 	= NOW()
        WHERE 1 = 1
          AND meeting_id 	= #{meetingId}
          AND user_id		= #{userId}
          AND deleted	 	= false
    </update>
	
    <!-- 회의록 조회 -->
    <select id="findByMeetingId" parameterType="long" resultMap="MeetingResultMap">
        SELECT meeting_id
        	  ,user_id
        	  ,title
        	  ,body
        	  ,description
        	  ,visibility
        	  ,status
        	  ,meeting_date
        	  ,start_time
        	  ,end_time
        FROM  meeting
        WHERE 1 = 1
          AND meeting_id 	= #{meetingId}
          AND deleted 		= false
    </select>

    <!-- 목록 조회 -->
    <select id="findAllByUserId" parameterType="long" resultMap="MeetingResultMap">
        SELECT meeting_id
         	  ,user_id
         	  ,title
         	  ,body
         	  ,description
         	  ,visibility
         	  ,status
         	  ,meeting_date
         	  ,start_time
         	  ,end_time
         	  ,deleted
        FROM  meeting
        WHERE 1 = 1
          AND user_id 	= #{userId}
          AND deleted 	= false
        ORDER BY created_date DESC
    </select>
</mapper>
